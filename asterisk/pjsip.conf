; Asterisk PJSIP Configuration for VoiceAI Platform
; SIP Trunk: 85.95.239.198 | Account: 101 | CallerID: 491632086421
; Ultravox Bridge: Accepts SIP from Ultravox/Voximplant for outbound calls

; ============================================
; Transport Configuration
; ============================================

[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5043
external_signaling_address=__EXTERNAL_IP__
external_media_address=__EXTERNAL_IP__
local_net=172.16.0.0/12
local_net=10.0.0.0/8
local_net=192.168.0.0/16

[transport-tcp]
type=transport
protocol=tcp
bind=0.0.0.0:5043
external_signaling_address=__EXTERNAL_IP__
external_media_address=__EXTERNAL_IP__
local_net=172.16.0.0/12
local_net=10.0.0.0/8
local_net=192.168.0.0/16


; ============================================
; SIP Trunk - MUTLU TELEKOM
; Server: 85.95.239.198
; Account: 101
; ============================================

; --- Registration (Asterisk registers TO the SIP server) ---
[trunk-reg]
type=registration
transport=transport-udp
outbound_auth=trunk-auth
server_uri=sip:85.95.239.198:5060
client_uri=sip:101@85.95.239.198:5060
contact_user=101
retry_interval=60
forbidden_retry_interval=300
expiration=300
line=yes
endpoint=trunk

; --- Authentication ---
[trunk-auth]
type=auth
auth_type=userpass
username=101
password=__SIP_TRUNK_PASSWORD__
realm=sippysoft.com

; --- AOR (Address of Record) ---
[trunk-aor]
type=aor
contact=sip:85.95.239.198:5060
qualify_frequency=30
qualify_timeout=3

; --- Endpoint (Main trunk config) ---
[trunk]
type=endpoint
context=from-trunk
disallow=all
allow=ulaw
allow=alaw
transport=transport-udp
outbound_auth=trunk-auth
aors=trunk-aor
direct_media=no
dtmf_mode=rfc4733
force_rport=yes
ice_support=no
rewrite_contact=yes
rtp_symmetric=yes
send_pai=yes
send_rpid=yes
trust_id_inbound=yes
from_user=101
from_domain=85.95.239.198
callerid="VoiceAI" <491632086421>

; --- Identify (Match incoming calls from trunk) ---
[trunk-identify]
type=identify
endpoint=trunk
match=85.95.239.198


; ============================================
; Ultravox SIP Endpoint
; Accepts incoming SIP INVITE from Ultravox/Voximplant
; and routes calls through the SIP trunk
; ============================================

; --- Authentication (Ultravox provides these in medium.sip.outgoing) ---
[ultravox-auth]
type=auth
auth_type=userpass
username=ultravox
password=__ULTRAVOX_SIP_PASSWORD__

; --- AOR ---
[ultravox-aor]
type=aor
max_contacts=50

; --- Endpoint ---
[ultravox]
type=endpoint
context=from-ultravox
disallow=all
allow=opus
allow=g722
allow=ulaw
allow=alaw
transport=transport-udp
auth=ultravox-auth
aors=ultravox-aor
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
dtmf_mode=rfc4733
ice_support=no


; ============================================
; Internal Endpoint for VoiceAI Application
; ============================================

[voiceai]
type=endpoint
context=voiceai-internal
disallow=all
allow=ulaw
transport=transport-udp
direct_media=no
rtp_symmetric=yes
aors=voiceai

[voiceai]
type=aor
max_contacts=100


; ============================================
; Media Configuration
; ============================================

[global]
type=global
max_forwards=70
user_agent=VoiceAI-Asterisk/1.0
default_outbound_endpoint=trunk
; Endpoint identification order: try IP match first, then username from From header
endpoint_identifier_order=ip,username


; ============================================
; System Configuration
; ============================================

[system]
type=system
timer_t1=500
timer_b=32000
